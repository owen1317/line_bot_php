{"filter":false,"title":"index2.php","tooltip":"/index2.php","undoManager":{"mark":24,"position":24,"stack":[[{"start":{"row":0,"column":0},"end":{"row":129,"column":0},"action":"insert","lines":["<?php","if(! mysql_connect(\"localhost\",\"startouch\",\"\"))","    die(\"connect false\");","//die = 執行到此行，將字串輸出後結束程式","    else echo 'OK!';","mysql_select_db(\"message_bot\");","","","// parameters","$hubVerifyToken = 'owen_cheng_test';","$accessToken = \"EAACT5g7ZAIJkBANpZAYtplIBKsV7wA0sncaHu9uHHCQCddaIt9COYTnADPxtXK2TpLT3J8ZACMTDIHwWpJBTaqe7JocS7cS67ZCxwulCpzl6guHlXeH0Ek1rAVBgq7EJAo06Lzw5VYJRDXLWKzt0vAVR5DMe5NIfZBsfFyWVOmwZDZD\";","// check token at setup","if ($_REQUEST['hub_verify_token'] === $hubVerifyToken) {","  echo $_REQUEST['hub_challenge'];","  exit;","}","// handle bot's anwser","$input = json_decode(file_get_contents('php://input'), true);","$senderId = $input['entry'][0]['messaging'][0]['sender']['id'];","$messageText = $input['entry'][0]['messaging'][0]['message']['text'];","$answer = \"I don't understand. Ask me 'hi'. Your fb id is \".$senderId;","if($messageText == \"hi\") {","    $answer = \"Hello\";","}","else if($messageText == \"我是店家管理者\"){","\t$sql = 'Insert into admin (fb_id,fan_page_id) VALUES ('.$senderId.','.$input['entry'][0]['messaging'][0]['recipient']['id'].')';","\t$result = mysql_query($sql);","\t$answer = \"已將您新增至店家管理者清單\";","}","","/*","    foreach(店家管理者清單){","        $response = [","            'recipient' => [ 'id' => $senderId ],","            'message' => [ 'text' => $answer ]","        ];","        $ch = curl_init('https://graph.facebook.com/v2.6/me/messages?access_token='.$accessToken);","        curl_setopt($ch, CURLOPT_POST, 1);","        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($response));","        curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);","        curl_exec($ch);","        curl_close($ch);","    }","*/","","$response = [","    'recipient' => [ 'id' => $senderId ],","    'message' => [ 'text' => $answer ]","];","$ch = curl_init('https://graph.facebook.com/v2.6/me/messages?access_token='.$accessToken);","curl_setopt($ch, CURLOPT_POST, 1);","curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($response));","curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);","curl_exec($ch);","curl_close($ch);","//based on http://stackoverflow.com/questions/36803518","","$response = [","    'recipient' => [ 'id' => 1133016060085386 ],","    'message' => [ 'text' => '傳送者ID'.$senderId ]","];","$ch = curl_init('https://graph.facebook.com/v2.6/me/messages?access_token='.$accessToken);","curl_setopt($ch, CURLOPT_POST, 1);","curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($response));","curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);","curl_exec($ch);","curl_close($ch);","","","","","","","","function debug($data,$option=['IsReturnString'=>false,'append'=>'']){","\tif(!isset($option['IsReturnString'])) $option['IsReturnString']=false;","\tif(!isset($option['append']) || $option['append']==''){","\t\tif(defined('CLI_MODE') && CLI_MODE){","\t\t\t$option['append']='';","\t\t}else{","\t\t\t$option['append']='pre';","\t\t}","\t}","\tswitch($option['append']){","\t\tcase 'textarea':","\t\t\t$append_start='<textarea cols=\"100\" rows=\"10\">';","\t\t\t$append_end='</textarea>';","\t\t\tbreak;","\t\tcase 'div':","\t\t\t$append_start='<div style=\"width: 1000px; height: 300px; border: 1px solid #ccc; overflow: auto;\">';","\t\t\t$append_end='</div>';","\t\t\tbreak;","\t\tcase 'pre':","\t\t\t$append_start='<pre>';","\t\t\t$append_end='</pre>';","\t\t\tbreak;","\t\tdefault:","\t\t\t$append_start='';","\t\t\t$append_end='';","\t\t\tbreak;","\t}","","\t$str=\"{$append_start}\";","\tforeach($data as $key=>$val){","\t\t$str.=\"$key => \".var_export($val,true).\"\\n\";","/*","\t\tif($option['IsReturnString']){","\t\t\t$str.=\"$key => \";","\t\t}else{","\t\t\techo \"$key => \";","\t\t}","\t\tif($option['IsReturnString']){","\t\t\t$str.=print_r($val,true);","// \t\t\t\t$str.=\"<br>\\n\";","\t\t}else{","\t\t\tvar_dump($val);","// \t\t\t\techo \"<br>\\n\";","\t\t}","*/","\t}","\t$str.=\"{$append_end}\";","","\tif($option['IsReturnString']){","\t\treturn $str;","\t}else{","\t\techo $str;","\t}","}","",""],"id":1}],[{"start":{"row":9,"column":34},"end":{"row":9,"column":35},"action":"insert","lines":["2"],"id":2}],[{"start":{"row":10,"column":16},"end":{"row":10,"column":192},"action":"remove","lines":["EAACT5g7ZAIJkBANpZAYtplIBKsV7wA0sncaHu9uHHCQCddaIt9COYTnADPxtXK2TpLT3J8ZACMTDIHwWpJBTaqe7JocS7cS67ZCxwulCpzl6guHlXeH0Ek1rAVBgq7EJAo06Lzw5VYJRDXLWKzt0vAVR5DMe5NIfZBsfFyWVOmwZDZD"],"id":3},{"start":{"row":10,"column":16},"end":{"row":10,"column":191},"action":"insert","lines":["EAAP56rUF8xQBAFnKIny50YCtxqaToilfZA3xFMWTQdyQnaWxEZAn41nfJsF67JktfvF0INZAxPQDGkgb9EMr4Lx8MzowYlEAwVKQw9AmLWOKsXuOFTfXCd1O34B7GzMGEOUBwOwrxEuSwKF8sy5KdJJxTS3ubs5ZCX7MmJBOcAZDZD"]}],[{"start":{"row":10,"column":16},"end":{"row":10,"column":191},"action":"remove","lines":["EAAP56rUF8xQBAFnKIny50YCtxqaToilfZA3xFMWTQdyQnaWxEZAn41nfJsF67JktfvF0INZAxPQDGkgb9EMr4Lx8MzowYlEAwVKQw9AmLWOKsXuOFTfXCd1O34B7GzMGEOUBwOwrxEuSwKF8sy5KdJJxTS3ubs5ZCX7MmJBOcAZDZD"],"id":4},{"start":{"row":10,"column":16},"end":{"row":10,"column":191},"action":"insert","lines":["EAAP56rUF8xQBAFnKIny50YCtxqaToilfZA3xFMWTQdyQnaWxEZAn41nfJsF67JktfvF0INZAxPQDGkgb9EMr4Lx8MzowYlEAwVKQw9AmLWOKsXuOFTfXCd1O34B7GzMGEOUBwOwrxEuSwKF8sy5KdJJxTS3ubs5ZCX7MmJBOcAZDZD"]}],[{"start":{"row":4,"column":15},"end":{"row":4,"column":17},"action":"remove","lines":["OK"],"id":5},{"start":{"row":4,"column":15},"end":{"row":4,"column":16},"action":"insert","lines":["q"]}],[{"start":{"row":4,"column":16},"end":{"row":4,"column":17},"action":"insert","lines":["w"],"id":6}],[{"start":{"row":4,"column":17},"end":{"row":4,"column":18},"action":"insert","lines":["e"],"id":7}],[{"start":{"row":4,"column":18},"end":{"row":4,"column":19},"action":"insert","lines":["e"],"id":8}],[{"start":{"row":1,"column":0},"end":{"row":1,"column":3},"action":"insert","lines":["// "],"id":9},{"start":{"row":2,"column":0},"end":{"row":2,"column":3},"action":"insert","lines":["// "]},{"start":{"row":3,"column":0},"end":{"row":3,"column":3},"action":"insert","lines":["// "]},{"start":{"row":4,"column":0},"end":{"row":4,"column":3},"action":"insert","lines":["// "]},{"start":{"row":5,"column":0},"end":{"row":5,"column":3},"action":"insert","lines":["// "]}],[{"start":{"row":47,"column":29},"end":{"row":47,"column":30},"action":"insert","lines":["j"],"id":10}],[{"start":{"row":47,"column":30},"end":{"row":47,"column":31},"action":"insert","lines":["s"],"id":11}],[{"start":{"row":47,"column":31},"end":{"row":47,"column":32},"action":"insert","lines":["o"],"id":12}],[{"start":{"row":47,"column":32},"end":{"row":47,"column":33},"action":"insert","lines":["n"],"id":13}],[{"start":{"row":47,"column":33},"end":{"row":47,"column":34},"action":"insert","lines":["_"],"id":14}],[{"start":{"row":47,"column":34},"end":{"row":47,"column":35},"action":"insert","lines":["e"],"id":15}],[{"start":{"row":47,"column":35},"end":{"row":47,"column":36},"action":"insert","lines":["n"],"id":16}],[{"start":{"row":47,"column":36},"end":{"row":47,"column":37},"action":"insert","lines":["c"],"id":17}],[{"start":{"row":47,"column":37},"end":{"row":47,"column":38},"action":"insert","lines":["o"],"id":18}],[{"start":{"row":47,"column":38},"end":{"row":47,"column":39},"action":"insert","lines":["d"],"id":19}],[{"start":{"row":47,"column":39},"end":{"row":47,"column":40},"action":"insert","lines":["e"],"id":20}],[{"start":{"row":47,"column":40},"end":{"row":47,"column":41},"action":"insert","lines":["("],"id":21}],[{"start":{"row":47,"column":41},"end":{"row":47,"column":42},"action":"insert","lines":[")"],"id":22}],[{"start":{"row":47,"column":42},"end":{"row":47,"column":49},"action":"remove","lines":["$answer"],"id":23}],[{"start":{"row":47,"column":41},"end":{"row":47,"column":47},"action":"insert","lines":["$input"],"id":24}],[{"start":{"row":47,"column":29},"end":{"row":47,"column":48},"action":"remove","lines":["json_encode($input)"],"id":29},{"start":{"row":47,"column":29},"end":{"row":47,"column":38},"action":"insert","lines":["$senderId"]}]]},"ace":{"folds":[],"scrolltop":430.5,"scrollleft":0,"selection":{"start":{"row":47,"column":38},"end":{"row":47,"column":40},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1480039891847,"hash":"d267c1ea37ac08edcbd3d418c97979c5a6161c1d"}