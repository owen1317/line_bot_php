{"filter":false,"title":"line_but_push_template","tooltip":"/line_but_push_template","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":108,"column":1},"action":"insert","lines":["","<?php","\tini_set(\"display_errors\", \"On\"); // 顯示錯誤是否打開( On=開, Off=關 )","\terror_reporting(E_ALL & ~E_NOTICE);","\t/* 輸入申請的Line Developers 資料  */","\t$channel_id = \"1492586591\";","\t$channel_secret = \"2eac9c639aea7e50a844de8d891203d7\";","\t$channel_access_token = \"HylxJGZOFpWGPWn+tUiCZCsPXK0z9Ymb13cP+f2p03lcGzg/Xl++4GEN6GPkCVeL94GrfjY06PI/ViwxKeToTUgOFiGxaxbqoR+nL2t3HdAliqdfUaMJ0GpyZijhPaJZ0yhRhVSWZCJtK5dI41OEHwdB04t89/1O/w1cDnyilFU=\";","\t ","\t ","\t// 將收到的資料整理至變數","\t$receive = json_decode(file_get_contents(\"php://input\"));","\t","\t// 讀取收到的訊息內容","\t$text = $receive->events[0]->message->text;","\t","\t// 讀取訊息來源的類型 \t[user, group, room]","\t$type = $receive->events[0]->source->type;","\t","\t// 由於新版的Messaging Api可以讓Bot帳號加入多人聊天和群組當中","\t// 所以在這裡先判斷訊息的來源","\tif ($type == \"room\")","\t{","\t\t// 多人聊天 讀取房間id","\t\t$from = $receive->events[0]->source->roomId;","\t} ","\telse if ($type == \"group\")","\t{","\t\t// 群組 讀取群組id","\t\t$from = $receive->events[0]->source->groupId;","\t}","\telse","\t{","\t\t// 一對一聊天 讀取使用者id","\t\t$from = $receive->events[0]->source->userId;","\t}","\t","\t// 讀取訊息的型態 [Text, Image, Video, Audio, Location, Sticker]","\t$content_type = $receive->events[0]->message->type;","\t","\t/* 準備Post回Line伺服器的資料 */","\t$header = [\"Content-Type: application/json\", \"Authorization: Bearer {\" . $channel_access_token . \"}\"];","\tpush($content_type, $text);","\t","\tfunction push(){","\t    global $header;","\t    $url = \"https://api.line.me/v2/bot/message/push\";","\t    ","\t    $data = [\"to\" => $_POST['receiver'], \"messages\" => array([\"type\" => \"text\", \"text\" => $_POST['message']])];","\t    $context = stream_context_create(array(","\t\t\"http\" => array(\"method\" => \"POST\", \"header\" => implode(PHP_EOL, $header), \"content\" => json_encode($data), \"ignore_errors\" => true)","\t\t));","\t\tfile_get_contents($url, false, $context);","\t}","\t","function debug($data,$option=['IsReturnString'=>false,'append'=>'']){","\tif(!isset($option['IsReturnString'])) $option['IsReturnString']=false;","\tif(!isset($option['append']) || $option['append']==''){","\t\tif(defined('CLI_MODE') && CLI_MODE){","\t\t\t$option['append']='';","\t\t}else{","\t\t\t$option['append']='pre';","\t\t}","\t}","\tswitch($option['append']){","\t\tcase 'textarea':","\t\t\t$append_start='<textarea cols=\"100\" rows=\"10\">';","\t\t\t$append_end='</textarea>';","\t\t\tbreak;","\t\tcase 'div':","\t\t\t$append_start='<div style=\"width: 1000px; height: 300px; border: 1px solid #ccc; overflow: auto;\">';","\t\t\t$append_end='</div>';","\t\t\tbreak;","\t\tcase 'pre':","\t\t\t$append_start='<pre>';","\t\t\t$append_end='</pre>';","\t\t\tbreak;","\t\tdefault:","\t\t\t$append_start='';","\t\t\t$append_end='';","\t\t\tbreak;","\t}","","\t$str=\"{$append_start}\";","\tforeach($data as $key=>$val){","\t\t$str.=\"$key => \".var_export($val,true).\"\\n\";","/*","\t\tif($option['IsReturnString']){","\t\t\t$str.=\"$key => \";","\t\t}else{","\t\t\techo \"$key => \";","\t\t}","\t\tif($option['IsReturnString']){","\t\t\t$str.=print_r($val,true);","// \t\t\t\t$str.=\"<br>\\n\";","\t\t}else{","\t\t\tvar_dump($val);","// \t\t\t\techo \"<br>\\n\";","\t\t}","*/","\t}","\t$str.=\"{$append_end}\";","","\tif($option['IsReturnString']){","\t\treturn $str;","\t}else{","\t\techo $str;","\t}","}"],"id":1}]]},"ace":{"folds":[],"scrolltop":1.5,"scrollleft":0,"selection":{"start":{"row":9,"column":2},"end":{"row":9,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1482224872781,"hash":"5f88eadff245c2a2f49e40f81c614f63ad807df4"}