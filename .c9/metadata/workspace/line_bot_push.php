{"filter":false,"title":"line_bot_push.php","tooltip":"/line_bot_push.php","ace":{"folds":[],"scrolltop":559.5,"scrollleft":0,"selection":{"start":{"row":47,"column":5},"end":{"row":47,"column":5},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"hash":"5f88eadff245c2a2f49e40f81c614f63ad807df4","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":45,"column":5},"end":{"row":45,"column":54},"action":"insert","lines":["$url = \"https://api.line.me/v2/bot/message/push\";"],"id":21}],[{"start":{"row":45,"column":54},"end":{"row":46,"column":0},"action":"insert","lines":["",""],"id":22},{"start":{"row":46,"column":0},"end":{"row":46,"column":5},"action":"insert","lines":["\t    "]}],[{"start":{"row":46,"column":5},"end":{"row":47,"column":0},"action":"insert","lines":["",""],"id":23},{"start":{"row":47,"column":0},"end":{"row":47,"column":5},"action":"insert","lines":["\t    "]}],[{"start":{"row":47,"column":5},"end":{"row":47,"column":87},"action":"insert","lines":["$data = [\"to\" => $from, \"messages\" => array([\"type\" => \"text\", \"text\" => $from])];"],"id":24}],[{"start":{"row":47,"column":22},"end":{"row":47,"column":27},"action":"remove","lines":["$from"],"id":25}],[{"start":{"row":47,"column":22},"end":{"row":47,"column":24},"action":"insert","lines":["''"],"id":27}],[{"start":{"row":47,"column":23},"end":{"row":47,"column":56},"action":"insert","lines":["U5e78fbb6c10ca739c1b5b8b205d28fce"],"id":29}],[{"start":{"row":47,"column":108},"end":{"row":47,"column":113},"action":"remove","lines":["$from"],"id":30},{"start":{"row":47,"column":108},"end":{"row":47,"column":109},"action":"insert","lines":["'"]}],[{"start":{"row":47,"column":109},"end":{"row":47,"column":110},"action":"insert","lines":["'"],"id":31}],[{"start":{"row":47,"column":109},"end":{"row":47,"column":110},"action":"insert","lines":["S"],"id":32}],[{"start":{"row":47,"column":110},"end":{"row":47,"column":111},"action":"insert","lines":["P"],"id":33}],[{"start":{"row":47,"column":111},"end":{"row":47,"column":112},"action":"insert","lines":["U"],"id":34}],[{"start":{"row":47,"column":112},"end":{"row":47,"column":113},"action":"insert","lines":["6"],"id":35}],[{"start":{"row":47,"column":112},"end":{"row":47,"column":113},"action":"remove","lines":["6"],"id":36}],[{"start":{"row":47,"column":111},"end":{"row":47,"column":112},"action":"remove","lines":["U"],"id":37}],[{"start":{"row":47,"column":110},"end":{"row":47,"column":111},"action":"remove","lines":["P"],"id":38}],[{"start":{"row":47,"column":109},"end":{"row":47,"column":110},"action":"remove","lines":["S"],"id":39}],[{"start":{"row":47,"column":109},"end":{"row":47,"column":110},"action":"insert","lines":["T"],"id":40}],[{"start":{"row":47,"column":110},"end":{"row":47,"column":111},"action":"insert","lines":["E"],"id":41}],[{"start":{"row":47,"column":111},"end":{"row":47,"column":112},"action":"insert","lines":["S"],"id":42}],[{"start":{"row":47,"column":112},"end":{"row":47,"column":113},"action":"insert","lines":["T"],"id":43}],[{"start":{"row":47,"column":113},"end":{"row":47,"column":114},"action":"insert","lines":["1"],"id":44}],[{"start":{"row":47,"column":114},"end":{"row":47,"column":115},"action":"insert","lines":["2"],"id":45}],[{"start":{"row":47,"column":115},"end":{"row":47,"column":116},"action":"insert","lines":["3"],"id":46}],[{"start":{"row":47,"column":116},"end":{"row":47,"column":117},"action":"insert","lines":["3"],"id":47}],[{"start":{"row":47,"column":117},"end":{"row":47,"column":118},"action":"insert","lines":["4"],"id":48}],[{"start":{"row":42,"column":1},"end":{"row":42,"column":6},"action":"remove","lines":["reply"],"id":49},{"start":{"row":42,"column":1},"end":{"row":42,"column":2},"action":"insert","lines":["P"]}],[{"start":{"row":42,"column":2},"end":{"row":42,"column":3},"action":"insert","lines":["U"],"id":50}],[{"start":{"row":42,"column":3},"end":{"row":42,"column":4},"action":"insert","lines":["S"],"id":51}],[{"start":{"row":42,"column":4},"end":{"row":42,"column":5},"action":"insert","lines":["H"],"id":52}],[{"start":{"row":42,"column":4},"end":{"row":42,"column":5},"action":"remove","lines":["H"],"id":53}],[{"start":{"row":42,"column":3},"end":{"row":42,"column":4},"action":"remove","lines":["S"],"id":54}],[{"start":{"row":42,"column":2},"end":{"row":42,"column":3},"action":"remove","lines":["U"],"id":55}],[{"start":{"row":42,"column":1},"end":{"row":42,"column":2},"action":"remove","lines":["P"],"id":56}],[{"start":{"row":42,"column":1},"end":{"row":42,"column":2},"action":"insert","lines":["p"],"id":57}],[{"start":{"row":42,"column":2},"end":{"row":42,"column":3},"action":"insert","lines":["u"],"id":58}],[{"start":{"row":42,"column":3},"end":{"row":42,"column":4},"action":"insert","lines":["s"],"id":59}],[{"start":{"row":42,"column":4},"end":{"row":42,"column":5},"action":"insert","lines":["h"],"id":60}],[{"start":{"row":47,"column":123},"end":{"row":48,"column":0},"action":"insert","lines":["",""],"id":61},{"start":{"row":48,"column":0},"end":{"row":48,"column":5},"action":"insert","lines":["\t    "]}],[{"start":{"row":48,"column":5},"end":{"row":51,"column":43},"action":"insert","lines":["$context = stream_context_create(array(","\t\t\"http\" => array(\"method\" => \"POST\", \"header\" => implode(PHP_EOL, $header), \"content\" => json_encode($data), \"ignore_errors\" => true)","\t\t));","\t\tfile_get_contents($url, false, $context);"],"id":62}],[{"start":{"row":146,"column":0},"end":{"row":180,"column":2},"action":"remove","lines":["\tfunction curlUserProfileFromLine($mid) {","\t\t","\t\tglobal $channel_access_token;","\t","\t\t$url = 'https://api.line.me/v2/bot/profile/' . $mid;","\t\t$ch = curl_init($url);","\t\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);","\t\tcurl_setopt($ch, CURLOPT_HTTPHEADER, array(","\t\t\t'Authorization: Bearer {' . $channel_access_token . '}',","\t\t));","\t\t","\t\t$json_content = curl_exec($ch);","\t\tcurl_close($ch);","\t\tif (!$json_content) {","\t\t\treturn false;","\t\t}","// \t\t{","// \t\t\t\"displayName\":\"LINE taro\",","// \t\t\t\"userId\":\"Uxxxxxxxxxxxxxx...\",","// \t\t\t\"pictureUrl\":\"http://obs.line-apps.com/...\",","// \t\t\t\"statusMessage\":\"Hello, LINE!\"","// \t\t}","\t\t$json = json_decode($json_content, true);","\t\t$url = $json['pictureUrl'];","\t\t$image_data = file_get_contents($url);","\t\t$image = imagecreatefromstring($image_data);","\t\timagejpeg($image, '/var/www/linebot/update/profile/'.$json['userId'].'jpeg'); // 於此目錄下, 產生實體圖片","\t\t$json['pictureUrl'] = \"https://linebot.andynote.com/update/profile/\".$json['userId'].'jpeg';","\t\t","\t\tif ($mid == $json['userId']) {","\t\t\t\treturn $json;","\t\t}","\t\t","\t\treturn false;","\t}"],"id":63}],[{"start":{"row":145,"column":1},"end":{"row":146,"column":0},"action":"remove","lines":["",""],"id":64}],[{"start":{"row":112,"column":0},"end":{"row":144,"column":2},"action":"remove","lines":["\tfunction getObjContent($filenameExtension){","\t\t","\t\tglobal $channel_access_token, $receive;","\t","\t\t$objID = $receive->events[0]->message->id;","\t\t$url = 'https://api.line.me/v2/bot/message/'.$objID.'/content';","\t\t$ch = curl_init($url);","\t\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);","\t\tcurl_setopt($ch, CURLOPT_HTTPHEADER, array(","\t\t\t'Authorization: Bearer {' . $channel_access_token . '}',","\t\t));","\t\t","\t\t$json_content = curl_exec($ch);","\t\tcurl_close($ch);","\t\tif (!$json_content) {","\t\t\treturn false;","\t\t}","\t\t","\t\t$fileURL = '/var/www/linebot/update/'.$objID.'.'.$filenameExtension;","\t\t$fp = fopen($fileURL, 'w');","\t\tfwrite($fp, $json_content);","\t\tfclose($fp);","\t\t","\t\tif ($filenameExtension==\".mp3\"){","\t\t\trequire_once(\"getID3/getid3/getid3.php\");","\t\t\t$getID3 = new getID3;","\t\t\t$fileData = $getID3->analyze($fileURL);","\t\t\t$audioInfo = var_dump($fileData);","\t\t\t$playSec = $audioInfo[\"playtime_seconds\"];","\t\t\t$re = array(\"https://linebot.andynote.com/update/\".$objID.'.'.$filenameExtension, $playSec);","\t\t}","\t\treturn \"https://linebot.andynote.com/update/\".$objID.'.'.$filenameExtension;","\t}"],"id":65}],[{"start":{"row":111,"column":1},"end":{"row":112,"column":0},"action":"remove","lines":["",""],"id":66}],[{"start":{"row":53,"column":0},"end":{"row":110,"column":2},"action":"remove","lines":["\t/* 發送訊息 */\t","\tfunction reply($content_type, $message) {","\t ","\t \tglobal $header, $from, $receive;","\t \t","\t\t$url = \"https://api.line.me/v2/bot/message/push\";","\t\t\t\t","// \t\t$profile = curlUserProfileFromLine($from);","// \t\t$userName = $profile['displayName'];","\t\t","\t\t","\t\t$data = [\"to\" => $from, \"messages\" => array([\"type\" => \"text\", \"text\" => $message])];","\t\t","\t\tswitch($content_type) {","\t\t","\t\t\tcase \"text\" :","\t\t\t\t$content_type = \"文字訊息\";","\t\t\t\t$data = [\"to\" => $from, \"messages\" => array([\"type\" => \"text\", \"text\" => $from])];","\t\t\t\tbreak;","\t\t\tcase \"image\" :","\t\t\t\t$content_type = \"圖片訊息\";","\t\t\t\t$message = getObjContent(\"jpeg\");","\t\t\t\t$data = [\"to\" => $from, \"messages\" => array([\"type\" => \"image\", \"originalContentUrl\" => $message, \"previewImageUrl\" => $message])];","\t\t\t\tbreak;","\t\t\tcase \"video\" :","\t\t\t\t$content_type = \"影片訊息\";","\t\t\t\t$message = getObjContent(\"mp4\");","\t\t\t\t$data = [\"to\" => $from, \"messages\" => array([\"type\" => \"video\", \"originalContentUrl\" => $message, \"previewImageUrl\" => $message])];","\t\t\t\tbreak;","\t\t\tcase \"audio\" :","\t\t\t\t$content_type = \"語音訊息\";","\t\t\t\t$message = getObjContent(\"mp3\");","\t\t\t\t$data = [\"to\" => $from, \"messages\" => array([\"type\" => \"audio\", \"originalContentUrl\" => $message[0], \"duration\" => $message[1]])];","\t\t\t\tbreak;","\t\t\tcase \"location\" :","\t\t\t\t$content_type = \"位置訊息\";","\t\t\t\t$title = $receive->events[0]->message->title;","\t\t\t\t$address = $receive->events[0]->message->address;","\t\t\t\t$latitude = $receive->events[0]->message->latitude;","\t\t\t\t$longitude = $receive->events[0]->message->longitude;","\t\t\t\t$data = [\"to\" => $from, \"messages\" => array([\"type\" => \"location\", \"title\" => $title, \"address\" => $address, \"latitude\" => $latitude, \"longitude\" => $longitude])];","\t\t\t\tbreak;","\t\t\tcase \"sticker\" :","\t\t\t\t$content_type = \"貼圖訊息\";","\t\t\t\t$packageId = $receive->events[0]->message->packageId;","\t\t\t\t$stickerId = $receive->events[0]->message->stickerId;","\t\t\t\t$data = [\"to\" => $from, \"messages\" => array([\"type\" => \"sticker\", \"packageId\" => $packageId, \"stickerId\" => $stickerId])];","\t\t\t\tbreak;","\t\t\tdefault:","\t\t\t\t$content_type = \"未知訊息\";","\t\t\t\tbreak;","\t   \t}","\t\t","\t\t$context = stream_context_create(array(","\t\t\"http\" => array(\"method\" => \"POST\", \"header\" => implode(PHP_EOL, $header), \"content\" => json_encode($data), \"ignore_errors\" => true)","\t\t));","\t\tfile_get_contents($url, false, $context);","\t}"],"id":67}],[{"start":{"row":52,"column":2},"end":{"row":53,"column":0},"action":"remove","lines":["",""],"id":68}],[{"start":{"row":53,"column":1},"end":{"row":53,"column":2},"action":"insert","lines":["\\"],"id":69}],[{"start":{"row":53,"column":1},"end":{"row":53,"column":2},"action":"remove","lines":["\\"],"id":70}],[{"start":{"row":53,"column":0},"end":{"row":53,"column":1},"action":"remove","lines":["\t"],"id":71}],[{"start":{"row":52,"column":2},"end":{"row":53,"column":0},"action":"remove","lines":["",""],"id":72}],[{"start":{"row":44,"column":17},"end":{"row":45,"column":0},"action":"insert","lines":["",""],"id":73},{"start":{"row":45,"column":0},"end":{"row":45,"column":5},"action":"insert","lines":["\t    "]}],[{"start":{"row":45,"column":5},"end":{"row":45,"column":37},"action":"insert","lines":["global $header, $from, $receive;"],"id":74}],[{"start":{"row":45,"column":19},"end":{"row":45,"column":36},"action":"remove","lines":[", $from, $receive"],"id":75}],[{"start":{"row":48,"column":109},"end":{"row":48,"column":118},"action":"remove","lines":["TEST12334"],"id":76},{"start":{"row":48,"column":109},"end":{"row":48,"column":110},"action":"insert","lines":["Y"]}],[{"start":{"row":48,"column":110},"end":{"row":48,"column":111},"action":"insert","lines":["u"],"id":77}],[{"start":{"row":48,"column":111},"end":{"row":48,"column":112},"action":"insert","lines":["t"],"id":78}],[{"start":{"row":48,"column":112},"end":{"row":48,"column":113},"action":"insert","lines":["o"],"id":79}],[{"start":{"row":48,"column":113},"end":{"row":48,"column":114},"action":"insert","lines":["u"],"id":80}],[{"start":{"row":48,"column":114},"end":{"row":48,"column":115},"action":"insert","lines":["c"],"id":81}],[{"start":{"row":48,"column":115},"end":{"row":48,"column":116},"action":"insert","lines":["h"],"id":82}],[{"start":{"row":48,"column":116},"end":{"row":48,"column":117},"action":"insert","lines":[" "],"id":83}],[{"start":{"row":48,"column":117},"end":{"row":48,"column":118},"action":"insert","lines":["C"],"id":84}],[{"start":{"row":48,"column":118},"end":{"row":48,"column":119},"action":"insert","lines":["L"],"id":85}],[{"start":{"row":48,"column":119},"end":{"row":48,"column":120},"action":"insert","lines":["3"],"id":86}],[{"start":{"row":48,"column":120},"end":{"row":48,"column":121},"action":"insert","lines":["1"],"id":87},{"start":{"row":48,"column":121},"end":{"row":48,"column":122},"action":"insert","lines":[";"]}],[{"start":{"row":48,"column":122},"end":{"row":48,"column":123},"action":"insert","lines":["4"],"id":88}],[{"start":{"row":48,"column":122},"end":{"row":48,"column":123},"action":"remove","lines":["4"],"id":89}],[{"start":{"row":48,"column":121},"end":{"row":48,"column":122},"action":"remove","lines":[";"],"id":90}],[{"start":{"row":48,"column":120},"end":{"row":48,"column":121},"action":"remove","lines":["1"],"id":91}],[{"start":{"row":48,"column":119},"end":{"row":48,"column":120},"action":"remove","lines":["3"],"id":92}],[{"start":{"row":48,"column":118},"end":{"row":48,"column":119},"action":"remove","lines":["L"],"id":93}],[{"start":{"row":48,"column":118},"end":{"row":48,"column":119},"action":"insert","lines":["c"],"id":94}],[{"start":{"row":48,"column":118},"end":{"row":48,"column":119},"action":"remove","lines":["c"],"id":95}],[{"start":{"row":48,"column":117},"end":{"row":48,"column":118},"action":"remove","lines":["C"],"id":96}],[{"start":{"row":48,"column":117},"end":{"row":48,"column":120},"action":"insert","lines":["好棒棒"],"id":104}],[{"start":{"row":48,"column":22},"end":{"row":48,"column":57},"action":"remove","lines":["'U5e78fbb6c10ca739c1b5b8b205d28fce'"],"id":105}],[{"start":{"row":48,"column":22},"end":{"row":48,"column":23},"action":"insert","lines":["$"],"id":107}],[{"start":{"row":48,"column":23},"end":{"row":48,"column":24},"action":"insert","lines":["_"],"id":108}],[{"start":{"row":48,"column":24},"end":{"row":48,"column":25},"action":"insert","lines":["P"],"id":109}],[{"start":{"row":48,"column":25},"end":{"row":48,"column":26},"action":"insert","lines":["O"],"id":110}],[{"start":{"row":48,"column":26},"end":{"row":48,"column":27},"action":"insert","lines":["S"],"id":111}],[{"start":{"row":48,"column":27},"end":{"row":48,"column":28},"action":"insert","lines":["T"],"id":112}],[{"start":{"row":48,"column":28},"end":{"row":48,"column":30},"action":"insert","lines":["[]"],"id":113}],[{"start":{"row":48,"column":29},"end":{"row":48,"column":31},"action":"insert","lines":["''"],"id":114}],[{"start":{"row":48,"column":30},"end":{"row":48,"column":31},"action":"insert","lines":["r"],"id":115}],[{"start":{"row":48,"column":31},"end":{"row":48,"column":32},"action":"insert","lines":["e"],"id":116}],[{"start":{"row":48,"column":32},"end":{"row":48,"column":33},"action":"insert","lines":["c"],"id":117}],[{"start":{"row":48,"column":33},"end":{"row":48,"column":34},"action":"insert","lines":["e"],"id":118}],[{"start":{"row":48,"column":34},"end":{"row":48,"column":35},"action":"insert","lines":["i"],"id":119}],[{"start":{"row":48,"column":35},"end":{"row":48,"column":36},"action":"insert","lines":["v"],"id":120}],[{"start":{"row":48,"column":36},"end":{"row":48,"column":37},"action":"insert","lines":["e"],"id":121}],[{"start":{"row":48,"column":37},"end":{"row":48,"column":38},"action":"insert","lines":["r"],"id":122}],[{"start":{"row":48,"column":91},"end":{"row":48,"column":104},"action":"remove","lines":["'Yutouch 好棒棒'"],"id":123},{"start":{"row":48,"column":91},"end":{"row":48,"column":109},"action":"insert","lines":["$_POST['receiver']"]}],[{"start":{"row":48,"column":99},"end":{"row":48,"column":107},"action":"remove","lines":["receiver"],"id":124}],[{"start":{"row":48,"column":99},"end":{"row":48,"column":100},"action":"insert","lines":["m"],"id":128}],[{"start":{"row":48,"column":100},"end":{"row":48,"column":101},"action":"insert","lines":["e"],"id":129}],[{"start":{"row":48,"column":101},"end":{"row":48,"column":102},"action":"insert","lines":["s"],"id":130}],[{"start":{"row":48,"column":102},"end":{"row":48,"column":103},"action":"insert","lines":["s"],"id":131}],[{"start":{"row":48,"column":103},"end":{"row":48,"column":104},"action":"insert","lines":["a"],"id":132}],[{"start":{"row":48,"column":104},"end":{"row":48,"column":105},"action":"insert","lines":["g"],"id":133}],[{"start":{"row":48,"column":105},"end":{"row":48,"column":106},"action":"insert","lines":["e"],"id":134}]]},"timestamp":1482223540866}